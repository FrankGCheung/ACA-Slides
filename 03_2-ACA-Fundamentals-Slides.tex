% move all configuration stuff into one file so we can focus on the content
\input{common}

\subtitle{Part 3.2: Fundamentals II}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
    % generate title page
	\input{titlepage}

    \section[overview]{lecture overview}
        \begin{frame}{introduction}{overview}
            \begin{itemize}
                \item   \textbf{text book}  
                    \begin{itemize}
                        \item   \href{http://ieeexplore.ieee.org/xpl/ebooks/bookPdfWithBanner.jsp?fileName=6331119.pdf&bkn=6266785&pdfType=chapter}{\underline{\textit{Chapter 2: Fundamentals} (pp.~18--28)}}
                    \end{itemize}
                \item   \textbf{additional reading}  
                    \begin{itemize}
                        \item   Richard G.~Lyons, \textit{Understanding Digital Signal Processing}, 3rd, Prentice Hall/Pearson, 2011
                    \end{itemize}
                \bigskip
                \item<2->   \textbf{lecture content}
                    \begin{itemize}
                        \item<2->   block-based processing
                        \item<3->   correlation
                        \item<4->   Fourier Transform
                        \item<5->   other time-frequency transforms
                    \end{itemize}
            \end{itemize}
        \end{frame}
        
    \section[intro]{introduction}
        \begin{frame}{audio signals}{signal categories}
        \end{frame}

    \section[processing blocks]{block-based processing}
        \begin{frame}{block based processing}{system implementation}
            typical audio applications process chunks of audio data:
            \vspace{-4mm}
            \begin{columns}
                \column{.6\textwidth}
                    \begin{figure}
                        \centering
                        \input{pict/fundamentals_BlockProcessing}	
                    \end{figure}
                \column{.4\textwidth}
                    \begin{itemize}
                        \item   $\mathcal{K}$: block length
                        \item   $\mathcal{H}$: hop length
                        \item   $n$: block index
                        \item   $i$: sample index
                    \end{itemize}
            \end{columns}
            \vspace{-2mm}
            \only<2>{
            \begin{itemize}
                \item   \textbf{reasons}:			
                    \begin{itemize}
                        \item	quasi-stationary signal properties
                        \item	internal block-based processing
                        \item	audio hardware characteristics (real-time systems)
                        \item	efficiency (memory allocation, SIMD)
                    \end{itemize}
            \end{itemize}}
            \only<3>{
            \begin{itemize}
                \item   \textbf{block boundaries}:
                    \begin{eqnarray*}
                        i_{\mathrm{s}}(n)	&=& i_{\mathrm{s}}(n-1) + \mathcal{H}\\
                        i_{\mathrm{e}}(n)		&=& i_{\mathrm{s}}(n) + \mathcal{K} - 1
                    \end{eqnarray*}
                \item   \textbf{overlap ratio}:
                    \begin{equation*}
                        o_{\mathrm{r}}	= \frac {\mathcal{K}-\mathcal{H}}{\mathcal{K}}
                    \end{equation*}
            \end{itemize}}
            \vspace{50mm}
        \end{frame}	

    \section[correlation]{correlation}
        \begin{frame}{correlation function}{introduction}
            \textbf{correlation function}: compute similarity between two \textit{stationary} signals $x$,$y$
            \begin{equation}
                r_\mathrm{xy}(\tau)=\mathcal{E}\lbrace x(t)y(t+\tau)\rbrace  
            \end{equation}  
            
            \begin{itemize}
                \item<2->	\textbf{continuous}:
                    \begin{equation*}
                        r_\mathrm{xy}(\tau) = \int\limits_{-\infty}^{\infty}{x(t)\cdot y(t+\tau)dt}
                    \end{equation*}
                \item<2->	\textbf{discrete}:
                    \begin{equation*}
                        r_\mathrm{xy}(\eta) = \sum\limits_{i=-\infty}^{\infty}{x(i)\cdot y(i+\eta)}
                    \end{equation*}
            \end{itemize}
        \end{frame}	

        \begin{frame}{correlation function}{animation}
            \vspace{-5mm}
            \begin{footnotesize}
                    \begin{eqnarray*}
                        r_\mathrm{xy}(\tau) &=& \int\limits_{-\infty}^{\infty}{x(t)\cdot y(t+\tau)dt}\\
                        r_\mathrm{xy}(\eta) &=& \sum\limits_{i=-\infty}^{\infty}{x(i)\cdot y(i+\eta)}
                    \end{eqnarray*}
            \end{footnotesize}
            \videowithmatlab{Correlation}
        \end{frame}

        \begin{frame}{correlation function}{examples}
            \question{draw the correlation function for}
            
            \only<2>
            {
			\begin{itemize}
				\item	rectangular window vs.
				\item	sine vs.
				\item	noise
			\end{itemize}
            }
            \pause
            \vspace{-7mm}
            \figwithmatlab{Correlation}
        \end{frame}	

        \begin{frame}{correlation function}{blocked correlation: animation}
            \videowithmatlab{BlockedCorrelation}
        \end{frame}	 

        \begin{frame}{correlation function}{normalization}
            \begin{equation*}\label{eq:corrnorm}
                \lambda_c = \frac{1}{\sqrt{\left(\sum\limits_{i=i_{\mathrm{s}}(n)}^{i_{\mathrm{e}}(n)}{x^2(i)}\right)\cdot \left(\sum\limits_{i=i_{\mathrm{s}}(n)}^{i_{\mathrm{e}}(n)}{y^2(i)}\right)}} 
            \end{equation*}
            
            \pause
            avoiding the triangular shape for blocked correlation:
            \pause
            \begin{enumerate}
                \item	modified normalization
                    \begin{equation*}
                        \lambda_c(\eta) = \frac{\mathcal{K}}{(\mathcal{K}-|\eta|)\cdot\sqrt{\left(\sum\limits_{i=i_{\mathrm{s}}(n)}^{i_{\mathrm{e}}(n)}{x^2(i)}\right)\cdot \left(\sum\limits_{i=i_{\mathrm{s}}(n)}^{i_{\mathrm{e}}(n)}{y^2(i)}\right)}} .
                    \end{equation*}
                \pause
                \item	different block lengths ($\mathcal{K},3\mathcal{K})$
                \pause
                \item	circular application
            \end{enumerate}
        \end{frame}	

        \begin{frame}{autocorrelation function}{definition \& properties}
            \toremember{correlation function with the signal itself}
            \begin{block}{autocorrelation function properties}
                \begin{itemize}
                    \item	{ACF} at lag $0$:\\
                    $r_{xx}(0,n) = 1$ if normalized, RMS otherwise
                
                    \item	maximum:\\
                    $|r_{xx}(\eta,n)| \leq r_{xx}(0,n)$ 
                    \item	symmetry:\\
                    $r_{xx}(\eta,n) = r_{xx}(-\eta,n)$
                    \item	periodicity:\\
                    The {ACF} of a periodic signal is periodic (period length of input signal)
                \end{itemize}	
            \end{block}
        \end{frame}	
        
        \begin{frame}{autocorrelation function}{matlab exercise}
            \matlabexercise{correlation}
            
            \begin{enumerate}
                \item   implement a Matlab function that computes the ACF for an arbitrary block length
                \item   compare results with matlab's \textsl{xcorr} function
                \item   consider only one half of the ACF and detect that highest local max that is not the absolute max
                \item   compute this ACF with overlapping blocks for the audio file \textsl{sax\_example.wav} 
                \item   plot that lag of the detected maxima over blocks and discuss the results
            \end{enumerate}
        \end{frame}
 
    \section{Fourier transform}
        \begin{frame}{fourier transform}{introduction}
            \figwithmatlab{FourierTransform}
            Fourier transform (overview):
            
            continuous (definition \& properties) $\bullet$ sampled $\bullet$ STFT $\bullet$ DFT
            \vspace{30mm}
        \end{frame}	

        \begin{frame}{fourier transform}{definition (continuous)}
            \begin {equation*}\label{eq:fourier_transformation}
                X(\jom) = \mathfrak{F}[x(t)] = \int\limits_{-\infty}^{\infty} {x(t) \e^{-\jom t}\, dt}
            \end {equation*}

            \pause
            remember: Fourier series coefficients 
            \begin {equation*}\label{eq:fourier_coeff}
                a_k = \frac{1}{T_0}\int\limits_{-\nicefrac{T_0}{2}}^{\nicefrac{T_0}{2}} x(t) \e^{-\jom_0kt}\, dt \nonumber
            \end {equation*}
            
            \begin{itemize}
                \item	$T_0\rightarrow \infty$ to allow the analysis of aperiodic functions
                \item[$\Rightarrow$] $k\omega_0 \rightarrow \omega$
            \end{itemize}
        \end{frame}	

        \begin{frame}{fourier transform}{property 1: invertibility}
            \begin{eqnarray*}\label{eq:ift}
                x(t) &=& \mathfrak{F}^{-1}[X(\jom)]\nonumber\\
                 &=& \frac{1}{2\pi}\int\limits_{-\infty}^{\infty} X(\jom) \e^{\jom t}\, d\omega 
            \end{eqnarray*}

            \begin{itemize}
                \item<2->   compare with Fourier series equation
                    \begin {equation*}
                        x(t) = \sum\limits_{k=-\infty}^{\infty} a_k \e^{\jom_0 k t} \nonumber
                    \end {equation*}
                \item<3->   time domain signal can be \textbf{perfectly reconstructed}~---~no information loss
                \item<3->   FT and IFT are very similar, largely equivalent
            \end{itemize}
        \end{frame}	

        %\begin{frame}{fourier transform}{property 2: superposition}
            %\begin{eqnarray}
                %y(t) &=& c_1\cdot x_1(t) + c_2\cdot x_2(t)\nonumber\\
                %\mapsto&&\nonumber\\
                %Y(\jom) &=& c_1\cdot X_1(\jom) + c_2\cdot X_2(\jom)\nonumber
            %\end{eqnarray}
            %\pause
            %\begin{itemize}
                %\item[]	Derivation
                        %\begin{footnotesize}
                            %\begin{eqnarray}
                                %Y(\jom) &=& \int\limits_{-\infty}^{\infty} {\big(c_1\cdot x_1(t) + c_2\cdot x_2(t)\big)\cdot \e^{-\jom t}\, dt}\nonumber\\
                                %\pause
                                %&=& c_1\cdot \int\limits_{-\infty}^{\infty} {x_1(t)  \e^{-\jom t}\, dt} + c_2\cdot \int\limits_{-\infty}^{\infty} {x_2(t) \e^{-\jom t}\, dt}\nonumber\\
                                %\pause
                                %&=& c_1\cdot X_1(\jom) + c_2\cdot X_2(\jom) 
                            %\end{eqnarray}
                        %\end{footnotesize}
            %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{property 3: convolution and multiplication}
            %\begin{eqnarray}
                %y(t) &= \int_{-\infty}^{\infty} {h(\tau) \cdot x(t-\tau)\, d\tau}\pause\mapsto 
                %Y(\jom) &= H(\jom)\cdot X(\jom) \nonumber
            %\end{eqnarray}
            %\pause
            %\begin{itemize}
                %\item[]	Derivation
                        %\begin{footnotesize}
                    %\begin{eqnarray}
                        %Y(\jom)	&=& \int_{-\infty}^{\infty} {y(t) \e^{-\jom t}\, dt}\nonumber\\
                                %\pause
                                    %&=& \int_{-\infty}^{\infty} {\left(\int_{-\infty}^{\infty} {h(\tau) \cdot x(t-\tau)\, d\tau}\right) \e^{-\jom t}\, dt}\nonumber\\
                                %\pause
                                    %&=& \int_{-\infty}^{\infty} {h(\tau) \int_{-\infty}^{\infty} {x(t-\tau)} \e^{-\jom t}\, dt\, d\tau}\nonumber\\
                                %\pause
                                    %&=& \int_{-\infty}^{\infty} {h(\tau)  \e^{-\jom \tau} \underbrace{\int_{-\infty}^{\infty} {x(t-\tau)} \e^{-\jom (t-\tau)}\, d(t-\tau)}_{X(\jom)}\, d\tau}\nonumber\\
                                %\pause
                                    %&=& \int_{-\infty}^{\infty} {h(\tau) \e^{-\jom \tau}\, d\tau} \cdot X(\jom)\nonumber\\
                                %\pause
                                    %&=& H(\jom) \cdot X(\jom)\label{eq:mult_conv} 
                    %\end{eqnarray}
                        %\end{footnotesize}
            %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{property 4: Parseval's theorem}
            %\begin{equation}
                %\int_{-\infty}^{\infty}{x^2(t)\, dt} = \frac{1}{2\pi}\int_{-\infty}^{\infty} {\left|X(\jom)\right|^2\, d\omega} 
            %\end{equation}
            %\pause
            %\begin{itemize}
                %\item[]	Derivation
                %\begin{footnotesize}
                    %\begin{equation}
                        %\int_{-\infty}^{\infty}{h(\tau)\cdot x(t-\tau)\, d\tau} = \frac{1}{2\pi}\int_{-\infty}^{\infty} {H(\jom)\cdot X(\jom) \e^{\jom t} d\omega}\nonumber
                    %\end{equation}
                     %\centering $H(\jom) \longrightarrow X^\ast (\jom)$/$h(\tau)\longrightarrow x(-\tau)$, $t = 0$
                                %\pause
                    %\begin{eqnarray}
                        %\int_{-\infty}^{\infty}{x(-\tau)\cdot x(-\tau)\, d\tau} &=& \frac{1}{2\pi}\int_{-\infty}^{\infty} {X^\ast (\jom)\cdot X(\jom) \, d\omega}\nonumber\\
                        %\pause
                        %\int_{-\infty}^{\infty}{x^2(t)\, dt} &=& \frac{1}{2\pi}\int_{-\infty}^{\infty} {\left|X(\jom)\right|^2\, d\omega} \nonumber
                    %\end{eqnarray}
                %\end{footnotesize}
            %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{property 5: time \& frequency shift}
            %\begin{equation}\label{eq:fft_timeshift}
                %Y(\jom) = X(\jom)\e^{-\jom t_0} 
            %\end{equation} 
            %\pause
            %\begin{itemize}
                %\item[]	Derivation
                %\begin{footnotesize}
                    %\begin{eqnarray}
                        %\int\limits_{-\infty}^{\infty} {x(t-t_0) \e^{-\jom t}\, dt} &=& \int\limits_{-\infty}^{\infty} {x(\tau) \e^{-\jom (\tau + t_0)}\, d\tau}\nonumber\\
                        %\pause
                        %&=& \e^{-\jom t_0}\int\limits_{-\infty}^{\infty} {x(\tau) \e^{-\jom \tau}\, d\tau}\nonumber\\
                        %\pause
                        %&=& \e^{-\jom t_0} \cdot X(\jom) \nonumber
                    %\end{eqnarray}
                %\end{footnotesize}
            %\end{itemize}
            %\pause
            %Frequency Shift:
            %\begin{equation}
                        %\frac{1}{2\pi}\int\limits_{-\infty}^{\infty} X(\jom-\omega_0) \e^{\jom t}\, d\omega = \e^{\jom_0 t}\cdot x(t) 		
            %\end{equation} 
%
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{property 6: symmetry}
            %\begin{eqnarray}
                %|X(\jom)| &=& |X(-\jom)|\\
                %\Phi_\mathrm{X}(\omega) &=& -\Phi_\mathrm{X}(-\omega) 
            %\end{eqnarray}
            %\pause
            %\vspace{-5mm}
            %\begin{itemize}
                %\item[]	Derivation
                %
                %\begin{footnotesize}
                    %time signal sum of even and odd component $x_e(t), x_o(t)$:
                    %\begin{equation}
                        %x(t) = \underbrace{\frac{1}{2}(x(t) + x(-t))}_{x_e(t)} + \underbrace{\frac{1}{2}(x(t) - x(-t))}_{x_o(t)} 
                    %\end{equation}
                    %\only<3-4>{
                    %\begin{equation}
                        %X_e(\jom) = \int\limits_{-\infty}^{\infty}{x_e(t)\cos(\omega t)\,dt} - \mathrm{j} \underbrace{\int\limits_{-\infty}^{\infty}{x_e(t)\sin(\omega t)\,dt}}_{= 0}\nonumber
                    %\end{equation}
                    %\pause
                    %\vspace{-5mm}
                    %\begin{itemize}
                        %\item[$\Rightarrow$]	$X_e(\jom)$ is real
                        %\item[$\Rightarrow$]	$X_e(\jom) = X_e(-\jom)$ (substitute $x(t)$ with $x(-t)$)
                    %\end{itemize}
                    %}
                    %\only<5-6>{
                    %\begin{equation}
                        %X_o(\jom) = \underbrace{\int\limits_{-\infty}^{\infty}{x_o(t)\cos(\omega t)\,dt}}_{=0} - \mathrm{j} \int\limits_{-\infty}^{\infty}{x_o(t)\sin(\omega t)\,dt} \nonumber
                    %\end{equation}
                    %\pause
                    %\vspace{-5mm}
                    %\begin{itemize}
                        %\item[$\Rightarrow$]	$X_o(\jom)$ is imaginary
                        %\item[$\Rightarrow$]	$X_o(\jom) = -X_o(-\jom)$ (substitute $x(t)$ with $-x(-t)$)
                    %\end{itemize}
                    %}
                %\end{footnotesize}
                %\vspace{500mm}
            %\end{itemize}
        %\end{frame}	
%
%
        %\begin{frame}{fourier transform}{property 7: time \& frequency scaling}
                    %\begin{equation}
                        %y(t) = x(c\cdot t) \mapsto Y(\jom) = \frac{1}{|c|}X\left(j\frac{\omega}{c}\right) 
                    %\end{equation}
            %\pause
            %\begin{itemize}
                %\item[]	Derivation
                %\begin{footnotesize}
                    %\begin{eqnarray}
                        %Y(\jom) &=& \int\limits_{-\infty}^{\infty} {x(c\cdot t) \e^{-\jom t}\, dt}\nonumber\\
                        %\pause
                        %&=& \int\limits_{-\infty}^{\infty} {x(\tau) \e^{-\jom \frac{\tau}{c}}\, d\frac{\tau}{c}}\nonumber\\
                        %\pause
                        %&=& \frac{1}{c}\int\limits_{-\infty}^{\infty} {x(\tau) \e^{-\mathrm{j} \frac{\omega}{c} \tau}\, d\tau}\nonumber\\
                        %\pause
                        %&=& \frac{1}{c} X\left(\mathrm{j}\frac{\omega}{c}\right) \nonumber
                    %\end{eqnarray}
                %\end{footnotesize}
            %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{examples}
                %\begin{flushright}
                     %\includegraphics[scale=.08]{Graph/question-mark}
                %\end{flushright}
                %\vspace{-3mm}
                %FT of:
                %\begin{itemize}
                    %\item	delta function
                    %\item	constant
                    %\item	cosine
                    %\item	rectangular window
                    %\item	delta pulse
                %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{sampled time signals}
            %\begin{eqnarray}\label{eq:ft_sampled}
                %\mathfrak{F}[x(i)] 	&=& \mathfrak{F}[x(t)\cdot \delta_\mathrm{T}(t)]\nonumber\\
                %\pause
                                    %&=& \mathfrak{F}[x(t)]\ast \mathfrak{F}[\delta_\mathrm{T}(t)]\nonumber\\
                                    %&=& X(\jom)\ast \Delta_\mathrm{T}(\jom) 
            %\end{eqnarray}
            %\pause
            %Fourier transform is \textbf{still continuous}
            %\begin{figure}
                %\centering
                    %\includegraphics[scale=.7]{\AcaGraph/spectral_overlap}
            %\end{figure}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{STFT}
            %short time Fourier transform (STFT):\\ compute Fourier transform only over a segment
%
            %\vspace{3mm}		
            %\pause
            %reasons:
            %\begin{itemize}
                %\item	\textbf{perception}: ear analyzes short segments of signal
                %\item	\textbf{signal properties}: choose quasi-periodic segment
                %\item	\textbf{hardware}: Fourier transform is inefficient and memory consuming for very long input segments
            %\end{itemize}
            %\pause
            %$\Rightarrow$ multiply a \textbf{window} with the signal
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{STFT: window functions}
            %multiplication in time domain\\ $\Rightarrow$ convolution in frequency domain
%
            %\pause		
            %\textbf{spectral leakage}
            %\begin{itemize}
                %\item	main lobe width
                %\item	side lobe height
                %\item	side lobe attenuation
            %\end{itemize}
            %\begin{figure}
                %\centering
                    %\includegraphics[scale=.7]{\AcaGraph/windows}
                %\label{fig:windows}
            %\end{figure}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{DFT}
            %digital domain: requires discrete frequency values:
            %
            %$\Rightarrow$ discrete Fourier transform
            %\begin{equation}\label{eq:dft}
                %X(\mathrm{j}\Delta\Omega) = \sum\limits_{i=0}^{\mathcal{K}-1}{x(i)\e^{-\mathrm{j}ki\frac{2\pi}{\mathcal{K}}}}
            %\end{equation}
            %with
            %\begin{equation}
                %\Delta\Omega = \frac{2\pi}{\mathcal{K}T_{\mathrm{S}}} = \frac{2\pi f_{\mathrm{S}}}{\mathcal{K}}
            %\end{equation}
            %
            %\pause
            %2 interpretations:
            %\begin{itemize}
                %\item	sampled continuous Fourier transform
                %\item	continuous Fourier transform of periodically extended time domain segment
            %\end{itemize}
        %\end{frame}	
%
        %\begin{frame}{fourier transform}{spectrogram}
            %\begin{figure}
                %\centering
                    %\includegraphics[scale=.85]{\AcaGraph/specgram}
            %\end{figure}
        %\end{frame}	
        
        \begin{frame}{fourier transform}{matlab exercise}
            \matlabexercise{spectrogram/STFT}
            
        \end{frame}
        
    \section[summary]{lecture summary}
        \begin{frame}{summary}{lecture content}
            %\begin{enumerate}
                %\item       what signals can be represented with the Fourier series?
                %\bigskip
                %\item<2->   why is the Fourier series helpful in describing signals?
                %\bigskip
                %\item<3->   what does the sampling theorem say?
                %\bigskip
                %\item<4->   can I perfectly reconstruct a quantized signal?
                %\bigskip
                %\item<5->   how does the quality of the quantization process depend on the wordlength?
                %\bigskip
                %\item<6->   why is the PDF a useful description for random signals?
            %\end{enumerate}
        \end{frame}
\end{document}

